(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(t){if(t.ep)return;t.ep=!0;const o=s(t);fetch(t.href,o)}})();const r=window.location.hostname==="localhost"?"/api":"https://gestionespese.onrender.com/api";async function c(){try{const i=await fetch(`${r}/health`),e=await i.json();return i.ok?(console.log("‚úÖ Connessione backend OK:",e.message),!0):(console.error("‚ùå Backend non raggiungibile"),!1)}catch(i){return console.error("‚ùå Errore connessione backend:",i),!1}}class l{constructor(){this.user=null,this.token=localStorage.getItem("token"),this.expenses=[],this.currentPage="welcome"}setUser(e,s){this.user=e,this.token=s,localStorage.setItem("token",s)}clearUser(){this.user=null,this.token=null,localStorage.removeItem("token")}isAuthenticated(){return!!this.token}}class d{constructor(e){this.state=e}async request(e,s={}){const n=`${r}${e}`,t={headers:{"Content-Type":"application/json",...s.headers},...s};this.state.token&&(t.headers.Authorization=`Bearer ${this.state.token}`);try{const o=await fetch(n,t),a=await o.json();if(!o.ok)throw new Error(a.message||"Errore nella richiesta");return a}catch(o){throw console.error("API Error:",o),o}}async signup(e,s){return this.request("/auth/signup",{method:"POST",body:JSON.stringify({email:e,password:s})})}async login(e,s){return this.request("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:s})})}async getExpenses(e={}){const s=new URLSearchParams;Object.keys(e).forEach(t=>{e[t]&&s.append(t,e[t])});const n=s.toString();return this.request(`/expenses${n?`?${n}`:""}`)}async createExpense(e){return this.request("/expenses",{method:"POST",body:JSON.stringify(e)})}async updateExpense(e,s){return this.request(`/expenses/${e}`,{method:"PUT",body:JSON.stringify(s)})}async deleteExpense(e){return this.request(`/expenses/${e}`,{method:"DELETE"})}}class u{constructor(){this.currentPage=null}showPage(e){console.log(`üîÑ Switching to page: ${e}`);const s=document.querySelectorAll(".page");console.log(`Found ${s.length} pages`),s.forEach(t=>{console.log(`Hiding page: ${t.id}`),t.classList.remove("active")});const n=document.getElementById(e);console.log("Target page:",n),n?(n.classList.add("active"),this.currentPage=e,console.log(`‚úÖ Successfully switched to ${e}`)):console.error(`‚ùå Page ${e} not found`)}showToast(e,s="info"){const n=document.getElementById("toast-container"),t=document.createElement("div");t.className=`toast ${s}`,t.textContent=e,n.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},5e3)}showModal(e){const s=document.getElementById(e);s&&s.classList.remove("hidden")}hideModal(e){const s=document.getElementById(e);s&&s.classList.add("hidden")}formatCurrency(e){return new Intl.NumberFormat("it-IT",{style:"currency",currency:"EUR"}).format(e)}formatDate(e){return new Intl.DateTimeFormat("it-IT").format(new Date(e))}setLoading(e,s){const n=document.getElementById(e);n&&(s?n.classList.remove("hidden"):n.classList.add("hidden"))}}class m{constructor(){this.state=new l,this.api=new d(this.state),this.ui=new u,this.currentFilters={},this.init()}async init(){await c()||this.ui.showToast("Errore connessione backend. Verifica che il server sia avviato.","error"),this.setupEventListeners(),this.checkAuthStatus()}checkAuthStatus(){this.state.isAuthenticated()?this.showDashboard():this.ui.showPage("welcome-page")}setupEventListeners(){console.log("üîß Setting up event listeners...");const e=document.getElementById("login-btn"),s=document.getElementById("signup-btn");console.log("Login button:",e),console.log("Signup button:",s),e?e.addEventListener("click",()=>{console.log("üîò Login button clicked!"),this.ui.showPage("login-page")}):console.error("‚ùå Login button not found!"),s?s.addEventListener("click",()=>{console.log("üîò Signup button clicked!"),this.ui.showPage("signup-page")}):console.error("‚ùå Signup button not found!"),document.getElementById("switch-to-signup").addEventListener("click",t=>{t.preventDefault(),this.ui.showPage("signup-page")}),document.getElementById("switch-to-login").addEventListener("click",t=>{t.preventDefault(),this.ui.showPage("login-page")}),document.getElementById("back-to-welcome-from-login").addEventListener("click",()=>{this.ui.showPage("welcome-page")}),document.getElementById("back-to-welcome-from-signup").addEventListener("click",()=>{this.ui.showPage("welcome-page")}),document.getElementById("login-form").addEventListener("submit",t=>{this.handleLogin(t)}),document.getElementById("signup-form").addEventListener("submit",t=>{this.handleSignup(t)}),document.getElementById("logout-btn").addEventListener("click",()=>{this.handleLogout()}),document.getElementById("expense-form").addEventListener("submit",t=>{this.handleAddExpense(t)}),document.getElementById("apply-filters").addEventListener("click",()=>{this.applyFilters()}),document.getElementById("clear-filters").addEventListener("click",()=>{this.clearFilters()}),document.getElementById("close-modal").addEventListener("click",()=>{this.ui.hideModal("edit-modal")}),document.getElementById("cancel-edit").addEventListener("click",()=>{this.ui.hideModal("edit-modal")}),document.getElementById("edit-expense-form").addEventListener("submit",t=>{this.handleEditExpense(t)});const n=new Date().toISOString().split("T")[0];document.getElementById("expense-date").value=n}async handleLogin(e){e.preventDefault();const s=document.getElementById("login-email").value,n=document.getElementById("login-password").value,t=e.target.querySelector('button[type="submit"]');try{t.disabled=!0,t.textContent="Accesso in corso...";const o=await this.api.login(s,n);this.state.setUser(o.user,o.token),this.ui.showToast("Login effettuato con successo!","success"),this.showDashboard()}catch(o){this.ui.showToast(o.message,"error")}finally{t.disabled=!1,t.textContent="Accedi"}}async handleSignup(e){e.preventDefault();const s=document.getElementById("signup-email").value,n=document.getElementById("signup-password").value,t=e.target.querySelector('button[type="submit"]');try{t.disabled=!0,t.textContent="Registrazione in corso...";const o=await this.api.signup(s,n);this.state.setUser(o.user,o.token),this.ui.showToast("Registrazione completata con successo!","success"),this.showDashboard()}catch(o){this.ui.showToast(o.message,"error")}finally{t.disabled=!1,t.textContent="Registrati"}}handleLogout(){this.state.clearUser(),this.ui.showToast("Logout effettuato","info"),this.ui.showPage("welcome-page")}async showDashboard(){this.ui.showPage("dashboard-page"),this.state.user&&(document.getElementById("user-email").textContent=this.state.user.email),await this.loadExpenses()}async handleAddExpense(e){e.preventDefault();const s={title:document.getElementById("expense-title").value,amount:Number.parseFloat(document.getElementById("expense-amount").value),category:document.getElementById("expense-category").value,date:document.getElementById("expense-date").value},n=e.target.querySelector('button[type="submit"]');try{n.disabled=!0,n.textContent="Aggiungendo...",await this.api.createExpense(s),this.ui.showToast("Spesa aggiunta con successo!","success"),e.target.reset();const t=new Date().toISOString().split("T")[0];document.getElementById("expense-date").value=t,await this.loadExpenses()}catch(t){this.ui.showToast(t.message,"error")}finally{n.disabled=!1,n.textContent="Aggiungi Spesa"}}async loadExpenses(){try{this.ui.setLoading("loading",!0);const e=await this.api.getExpenses(this.currentFilters);this.state.expenses=e.expenses,this.renderExpenses(e.expenses),this.updateSummary(e.expenses,e.totalAmount),this.ui.setLoading("loading",!1),e.expenses.length===0?document.getElementById("no-expenses").classList.remove("hidden"):document.getElementById("no-expenses").classList.add("hidden")}catch{this.ui.setLoading("loading",!1),this.ui.showToast("Errore nel caricamento delle spese","error")}}renderExpenses(e){const s=document.getElementById("expenses-list");if(e.length===0){s.innerHTML="";return}s.innerHTML=e.map(n=>`
      <div class="expense-item">
        <div class="expense-info">
          <h4>${n.title}</h4>
          <div class="expense-meta">
            <span>üìÖ ${this.ui.formatDate(n.date)}</span>
            <span>üè∑Ô∏è ${n.category}</span>
          </div>
        </div>
        <div class="expense-amount">${this.ui.formatCurrency(n.amount)}</div>
        <div class="expense-actions">
          <button class="btn btn-edit" onclick="app.editExpense('${n.id}')">
            Modifica
          </button>
          <button class="btn btn-danger" onclick="app.deleteExpense('${n.id}')">
            Elimina
          </button>
        </div>
      </div>
    `).join("")}updateSummary(e,s){document.getElementById("total-amount").textContent=this.ui.formatCurrency(s),document.getElementById("total-count").textContent=e.length}editExpense(e){const s=this.state.expenses.find(n=>n.id===e);s&&(document.getElementById("edit-expense-id").value=s.id,document.getElementById("edit-expense-title").value=s.title,document.getElementById("edit-expense-amount").value=s.amount,document.getElementById("edit-expense-category").value=s.category,document.getElementById("edit-expense-date").value=s.date.split("T")[0],this.ui.showModal("edit-modal"))}async handleEditExpense(e){e.preventDefault();const s=document.getElementById("edit-expense-id").value,n={title:document.getElementById("edit-expense-title").value,amount:Number.parseFloat(document.getElementById("edit-expense-amount").value),category:document.getElementById("edit-expense-category").value,date:document.getElementById("edit-expense-date").value},t=e.target.querySelector('button[type="submit"]');try{t.disabled=!0,t.textContent="Salvando...",await this.api.updateExpense(s,n),this.ui.showToast("Spesa aggiornata con successo!","success"),this.ui.hideModal("edit-modal"),await this.loadExpenses()}catch(o){this.ui.showToast(o.message,"error")}finally{t.disabled=!1,t.textContent="Salva Modifiche"}}async deleteExpense(e){if(confirm("Sei sicuro di voler eliminare questa spesa?"))try{await this.api.deleteExpense(e),this.ui.showToast("Spesa eliminata con successo!","success"),await this.loadExpenses()}catch(s){this.ui.showToast(s.message,"error")}}applyFilters(){this.currentFilters={category:document.getElementById("filter-category").value,startDate:document.getElementById("filter-start-date").value,endDate:document.getElementById("filter-end-date").value},Object.keys(this.currentFilters).forEach(e=>{(!this.currentFilters[e]||this.currentFilters[e]==="all")&&delete this.currentFilters[e]}),this.loadExpenses()}clearFilters(){this.currentFilters={},document.getElementById("filter-category").value="all",document.getElementById("filter-start-date").value="",document.getElementById("filter-end-date").value="",this.loadExpenses()}}document.addEventListener("DOMContentLoaded",()=>{const i=new m;window.app=i,console.log("üéâ Expense Tracker inizializzato!")});
//# sourceMappingURL=index-ai3qNkbx.js.map
